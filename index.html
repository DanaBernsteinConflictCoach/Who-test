<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WHO Assessment</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #4CAF50; /* Green background */
    color: #fff;
    margin: 0;
    padding: 0 20px;
  }

  h2, h3 {
    margin-top: 20px;
  }

  .step {
    margin-bottom: 40px;
  }

  .field {
    margin-bottom: 15px;
  }

  input[type="text"], textarea, select {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: none;
    font-size: 14px;
  }

  textarea {
    height: 60px;
  }

  .btn {
    padding: 6px 12px;
    margin: 2px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-weight: bold;
  }

  .btn-primary {
    background-color: #fff;
    color: #4CAF50;
  }

  .btn-ghost {
    background-color: transparent;
    border: 1px solid #fff;
    color: #fff;
  }

  .kv {
    margin-top: 10px;
  }

  .muted {
    color: rgba(255,255,255,0.8);
    font-size: 13px;
  }

  .pill {
    display: inline-block;
    padding: 5px 10px;
    margin: 3px;
    border-radius: 20px;
    background-color: #fff;
    color: #4CAF50;
    cursor: pointer;
  }

  #app, #results {
    max-width: 800px;
    margin: auto;
  }

  #progressText {
    margin-top: 10px;
    font-weight: bold;
  }

  #progressFill {
    height: 8px;
    background-color: #fff;
    width: 0;
    border-radius: 5px;
    margin-bottom: 20px;
  }

  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  footer {
    margin-top: 40px;
    padding: 10px 0;
    text-align: center;
    font-size: 13px;
    background-color: #3E8E41;
  }

</style>
</head>
<body>

<div id="app">
  <div id="progressFill"></div>
  <div id="progressText"></div>
  <div id="stepHost"></div>

  <div>
    <button class="btn btn-ghost" id="backBtn">Back</button>
    <button class="btn btn-primary" id="nextBtn">Next</button>
    <button class="btn btn-ghost" id="resetBtn">Reset</button>
  </div>
</div>

<div id="results" hidden>
  <div id="resultsBody"></div>
  <button class="btn btn-primary" id="editBtn">Edit</button>
  <button class="btn btn-ghost" id="copyBtn">Copy summary</button>
</div>

<footer>
  &copy; 2025 https://www.mywhothoughts.com; Based on the book "It's the Thought That Counts, Mastering the Art of YOU vs you"
</footer>

<script>
const STORAGE_KEY = "who_assessment_v2_dana";
const MAIN_SITE = "https://MyWHOthoughts.com";

const DEFAULTS = {
  proudMoment: "", proudWhy: "", upsetMoment: "", upsetWhy: "",
  valueCandidates: [], valuesFinal: [],
  happiestMoment: "", pillarCandidates: [], pillarsFinal: [],
  idealEmotion: "", emotionWhy: "", emotionLevel: 8,
  triggerStatement: "", triggerPlan: ""
};

const VALUE_OPTIONS = [
  "Accountability","Adventure","Authenticity","Considerate","Curiosity",
  "Do-er","Efficient","Empathy","Ethics","Excellence","Fairness","Gratitude",
  "Honesty","Impact","Independence","Inclusivity","Integrity","Justice","Kind",
  "Loyalty","Open Mind","Perseverance","Reliability","Resilience","Respect",
  "Self Reliance","Service","Structure","Transparency"
];

const PILLAR_OPTIONS = [
  "Adventurer","Bold","Builder","Caretaker","Community","Compassion","Confident",
  "Connection","Connector","Considerate","Creative","Earthy","Explorer","Faith",
  "Family","Fierce","Fun","Goofy","Grounded","Gratitude","Helper","Humor","Introspective",
  "Impact","Kind","Laughter","Limitless","Listener","Love","Nerdy","Open Mind","Optimist",
  "Passion","Patient","Peace","Playful","Present","Problem Solver","Sarcastic","Service"
];

const IDEAL_EMOTION_OPTIONS = [
  "Calm","Carefree","Clear","Connected","Content","Energized","Fulfilled","Freedom",
  "Grateful","Gratitude","Happiness","Inspired","Joy","Peace","Playful","Present","Serenity"
];

const TRIGGER_OPTIONS = [
  "Capable","Enough","Fast Enough","Good Enough","Heard","Listened to",
  "Respected","Seen","Smart","Valued","Wanted"
];

let state = loadState();
let stepIndex = 0;

const elApp = document.getElementById("app");
const elResults = document.getElementById("results");
const stepHost = document.getElementById("stepHost");

const startBtn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const backBtn  = document.getElementById("backBtn");
const nextBtn  = document.getElementById("nextBtn");

const editBtn  = document.getElementById("editBtn");
const copyBtn  = document.getElementById("copyBtn");

function steps() {
  return [
    renderValuesStep,
    renderPillarsStep,
    renderIdealEmotionStep,
    renderTriggerStep
  ];
}

function render() {
  elApp.hidden = false;
  elResults.hidden = true;

  const total = steps().length;
  const current = stepIndex + 1;

  document.getElementById("progressFill").style.width = `${(current / total) * 100}%`;
  document.getElementById("progressText").textContent = `Step ${current} of ${total}`;

  backBtn.disabled = stepIndex === 0;
  nextBtn.textContent = (stepIndex === total - 1) ? "Finish" : "Next";

  stepHost.innerHTML = "";
  steps()[stepIndex]();
}

// -------------------- Step 1: Values --------------------
function renderValuesStep() {
  const wrap = document.createElement("div");
  wrap.className = "step";

  wrap.innerHTML = `
    <h2>Values (Discover)</h2>
    <p>Discover your values through your proudest and most frustrating moments.</p>
    <div class="field"><label>Proud Moment</label><textarea id="proudMoment">${state.proudMoment}</textarea></div>
    <div class="field"><label>Why</label><textarea id="proudWhy">${state.proudWhy}</textarea></div>
    <div class="field"><label>Upset / Frustrated Moment</label><textarea id="upsetMoment">${state.upsetMoment}</textarea></div>
    <div class="field"><label>Why</label><textarea id="upsetWhy">${state.upsetWhy}</textarea></div>
    <div class="field"><label>Candidate Values</label><div id="valuePills"></div>
      <input id="customValue" type="text" placeholder="Add custom value" />
    </div>
    <div class="field">
      <strong>Confirmed Values:</strong>
      <div id="valuesFinal" class="kv">${state.valuesFinal.length ? state.valuesFinal.join("<br>") : "None yet"}</div>
    </div>
  `;
  stepHost.appendChild(wrap);

  ["proudMoment","proudWhy","upsetMoment","upsetWhy"].forEach(id => {
    wrap.querySelector("#"+id).addEventListener("input", e => { state[id]=e.target.value; saveState(); });
  });

  const pillsContainer = wrap.querySelector("#valuePills");
  VALUE_OPTIONS.forEach(v => {
    const pill = document.createElement("div");
    pill.className="pill";
    pill.textContent = v;
    pill.addEventListener("click", ()=>{pushUnique(state.valueCandidates,v); render();});
    pillsContainer.appendChild(pill);
  });

  wrap.querySelector("#customValue").addEventListener("keydown", e=>{
    if(e.key==="Enter"){e.preventDefault(); pushUnique(state.valueCandidates, e.target.value); e.target.value=""; saveState(); render();}
  });

  wrap.querySelector("#valuesFinal").innerHTML = state.valuesFinal.length ? state.valuesFinal.join("<br>") : "None yet";
}

// -------------------- Step 2: Pillars --------------------
function renderPillarsStep() {
  const wrap = document.createElement("div");
  wrap.className="step";

  wrap.innerHTML=`
    <h2>Pillars (Discover)</h2>
    <div class="field">
      <label>Happiest / Best Self</label>
      <textarea id="happiestMoment">${state.happiestMoment}</textarea>
    </div>
    <div class="field">
      <label>Add Pillar candidates</label>
      <input id="customPillarTrait" placeholder="e.g., Community, Optimist" />
      <div id="pillarList" class="kv">${state.pillarCandidates.join("<br>")}</div>
    </div>
    <div class="field">
      <strong>Confirmed Pillars:</strong>
      <div id="pillarsFinal" class="kv">${state.pillarsFinal.join("<br>")}</div>
    </div>
  `;
  stepHost.appendChild(wrap);

  wrap.querySelector("#happiestMoment").addEventListener("input", e=>{state.happiestMoment=e.target.value; saveState();});
  wrap.querySelector("#customPillarTrait").addEventListener("keydown", e=>{
    if(e.key==="Enter"){e.preventDefault(); pushUnique(state.pillarCandidates,e.target.value); e.target.value=""; saveState(); render();}
  });
}

// -------------------- Step 3: Ideal Emotion --------------------
function renderIdealEmotionStep() {
  const wrap = document.createElement("div"); wrap.className="step";
  wrap.innerHTML=`
    <h2>Ideal Emotion</h2>
    <div class="field">
      <label>Pick one:</label>
      <select id="idealEmotion">
        <option value="">Select…</option>
        ${IDEAL_EMOTION_OPTIONS.map(x=>`<option ${state.idealEmotion===x?"selected":""}>${x}</option>`).join("")}
      </select>
    </div>
    <div class="field">
      <label>Why (optional)</label>
      <input id="emotionWhy" value="${state.emotionWhy}" />
    </div>
    <div class="field">
      <label>Intensity (1–10)</label>
      <input type="range" min="1" max="10" value="${state.emotionLevel}" id="emotionLevel" />
      <span id="emotionLevelLabel">${state.emotionLevel}</span>
    </div>
  `;
  stepHost.appendChild(wrap);

  wrap.querySelector("#idealEmotion").addEventListener("change", e=>{state.idealEmotion=e.target.value; saveState();});
  wrap.querySelector("#emotionWhy").addEventListener("input", e=>{state.emotionWhy=e.target.value; saveState();});
  wrap.querySelector("#emotionLevel").addEventListener("input", e=>{
    state.emotionLevel=+e.target.value;
    document.getElementById("emotionLevelLabel").textContent=state.emotionLevel;
    saveState();
  });
}

// -------------------- Step 4: Trigger --------------------
function renderTriggerStep() {
  const wrap = document.createElement("div"); wrap.className="step";
  wrap.innerHTML=`
    <h2>Trigger (Anti-WHO)</h2>
    <div class="field">
      <label>My Trigger is… “I’m not ____”</label>
      <input id="triggerStatement" value="${state.triggerStatement}" />
    </div>
    <div class="field">
      <label>Plan to respond</label>
      <textarea id="triggerPlan">${state.triggerPlan}</textarea>
    </div>
  `;
  stepHost.appendChild(wrap);

  wrap.querySelector("#triggerStatement").addEventListener("input", e=>{state.triggerStatement=e.target.value; saveState();});
  wrap.querySelector("#triggerPlan").addEventListener("input", e=>{state.triggerPlan=e.target.value; saveState();});
}

// -------------------- Navigation --------------------
backBtn.addEventListener("click", ()=>{if(stepIndex>0) stepIndex--; render();});
nextBtn.addEventListener("click", ()=>{
  if(stepIndex<steps().length-1){stepIndex++; render();}
  else{showResults();}
});
resetBtn.addEventListener("click", ()=>{state=structuredClone(DEFAULTS); stepIndex=0; saveState(); render();});
editBtn.addEventListener("click", ()=>{elResults.hidden=true; elApp.hidden=false; render();});
copyBtn.addEventListener("click", async ()=>{
  try{await navigator.clipboard.writeText(buildSummaryText()); copyBtn.textContent="Copied ✓"; setTimeout(()=>copyBtn.textContent="Copy summary",1200);}
  catch{alert(buildSummaryText());}
});

// -------------------- Results --------------------
function showResults(){
  elApp.hidden=true; elResults.hidden=false;
  const values=state.valuesFinal; const pillars=state.pillarsFinal;
  document.getElementById("resultsBody").innerHTML=`
    <h3>Values</h3><div>${values.length?values.join("<br>"):"None"}</div>
    <h3>Pillars</h3><div>${pillars.length?pillars.join("<br>"):"None"}</div>
    <h3>Ideal Emotion</h3><div>${state.idealEmotion||"None"} (Target: ${state.emotionLevel}/10)</div>
    <h3>Trigger</h3><div>${state.triggerStatement||"None"}<br>${state.triggerPlan||""}</div>
  `;
  saveState();
}

function buildSummaryText(){
  return `
WHO Snapshot
VALUES:
${state.valuesFinal.length?state.valuesFinal.map(v=>"- "+v).join("\n"):"- None"}
PILLARS:
${state.pillarsFinal.length?state.pillarsFinal.map(p=>"- "+p).join("\n"):"- None"}
IDEAL EMOTION:
- ${state.idealEmotion||"(none)"} (Target: ${state.emotionLevel}/10)
${state.emotionWhy? "- Why: "+state.emotionWhy:""}
TRIGGER:
- ${state.triggerStatement||"(none)"}
${state.triggerPlan? "- Plan: "+state.triggerPlan:""}
Main site: ${MAIN_SITE}
`.trim();
}

// -------------------- Utilities --------------------
function saveState(){localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}
function loadState(){try{const raw=localStorage.getItem(STORAGE_KEY);return raw?{...structuredClone(DEFAULTS),...JSON.parse(raw)}:structuredClone(DEFAULTS);}catch{return structuredClone(DEFAULTS);}}
function pushUnique(arr,val){val=(val||"").trim(); if(val&&!arr.includes(val)) arr.push(val);}

// -------------------- Init --------------------
render();

</script>
</body>
</html>
